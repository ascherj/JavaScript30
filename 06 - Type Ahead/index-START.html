<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ðŸ‘€</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>

class Places {
  ENDPOINT = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';
  places = [];
  searchInput = document.querySelector('.search');
  suggestionsUl = document.querySelector('.suggestions');

  constructor() {
    this.init();
  }

  init() {
    this.getPlaces()
      .then(res => {
        console.log('Got places:', res);
        this.places = res;
      })
      .catch(err => console.error(err));

    this.searchInput.addEventListener('keyup', (e) => {
      this.filterPlaces(e.target.value);
    });
  }

  getPlaces() {
    return fetch(this.ENDPOINT)
      .then(res => res.blob())
      .then(blob => blob.text())
      .then(text => JSON.parse(text));  
  }

  filterPlaces(query) {
    const regex = new RegExp(query, 'gi');

    const filteredPlaces = this.places.filter(place => {
      return place.city.match(regex) || place.state.match(regex);
    });

    console.log('Filtered places:', filteredPlaces);
    
    this.displayPlaces(filteredPlaces);
  };

  displayPlaces(places) {
    const formattedPlaces = places.map(place => {
      return `
        <li>
          ${place.city}, ${place.state}
          <span>${place.population}</span>
        </li>
      `;
    }).join('');
    this.suggestionsUl.innerHTML = formattedPlaces;
  }
}

// const getPlaces = () => {
//   return fetch(ENDPOINT)
//     .then(res => res.blob())
//     .then(blob => blob.text())
//     .then(text => JSON.parse(text));
// }

// const filterPlaces = (query) => {
//   const regex = new RegExp(query, 'gi');

//   const filteredPlaces = places.filter(place => {
//     return place.city.match(regex) || place.state.match(regex);
//   });

//   displayPlaces(filteredPlaces);
// };

// const displayPlaces = (places) => {
//   const formattedPlaces = places.map(place => {
//     return `
//       <li>
//         ${place.city}, ${place.state}
//         <span>${place.population}</span>
//       </li>
//     `;
//   }).join('');
//   suggestionsUl.innerHTML = formattedPlaces;
// };

// getPlaces()
//   .then(res => {
//     console.log('Got places:', res);
//     places.push(...res);
//   })
//   .catch(err => console.error(err));

// searchInput.addEventListener('keyup', (e) => {
//   filterPlaces(e.target.value);
// });

new Places();

</script>
</body>
</html>
